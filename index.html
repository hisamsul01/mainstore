<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>üì¶ Sistem Manajemen Stok</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    /* Animasi transisi */
    .fade-enter { opacity: 0; transform: translateY(20px); }
    .fade-enter-active { opacity: 1; transform: translateY(0); transition: all 0.5s ease-in-out; }
    .fade-exit { opacity: 1; transform: translateY(0); }
    .fade-exit-active { opacity: 0; transform: translateY(-20px); transition: all 0.5s ease-in-out; }
  </style>
</head>
<body class="bg-gray-100 flex min-h-screen">

  <!-- Sidebar -->
  <aside class="w-64 bg-blue-700 text-white p-6 flex flex-col space-y-4">
    <h1 class="text-2xl font-bold mb-6">üì¶ StokApp</h1>
    <button onclick="showPage('dashboard')" class="hover:bg-blue-600 p-2 rounded">Dashboard</button>
    <button onclick="showPage('barang')" class="hover:bg-blue-600 p-2 rounded">Barang</button>
    <button onclick="showPage('transaksi')" class="hover:bg-blue-600 p-2 rounded">Transaksi</button>
    <button onclick="showPage('store')" class="hover:bg-blue-600 p-2 rounded">Store</button>
    <button onclick="showPage('laporan')" class="hover:bg-blue-600 p-2 rounded">Laporan</button>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-6" id="main-content">

    <!-- Dashboard -->
    <section id="dashboard" class="page">
      <h2 class="text-2xl font-bold mb-6">üìä Dashboard</h2>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="p-6 bg-gradient-to-r from-green-400 to-green-600 rounded-2xl shadow-lg text-white transform transition hover:scale-105">
          <h3 class="text-lg font-semibold">Barang Tersedia</h3>
          <p id="stok-tersedia" class="text-3xl font-bold mt-2">0</p>
        </div>
        <div class="p-6 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl shadow-lg text-white transform transition hover:scale-105">
          <h3 class="text-lg font-semibold">Hampir Habis</h3>
          <p id="stok-hampir" class="text-3xl font-bold mt-2">0</p>
        </div>
        <div class="p-6 bg-gradient-to-r from-red-500 to-pink-600 rounded-2xl shadow-lg text-white transform transition hover:scale-105">
          <h3 class="text-lg font-semibold">Stok Habis</h3>
          <p id="stok-habis" class="text-3xl font-bold mt-2">0</p>
        </div>
        <div class="p-6 bg-gradient-to-r from-blue-400 to-indigo-600 rounded-2xl shadow-lg text-white transform transition hover:scale-105">
          <h3 class="text-lg font-semibold">Jumlah Store</h3>
          <p id="total-store" class="text-3xl font-bold mt-2">0</p>
        </div>
      </div>
    </section>

    <!-- Barang -->
    <section id="barang" class="page hidden">
      <h2 class="text-2xl font-bold mb-6">üì¶ Barang</h2>
      <form id="form-masuk" class="grid md:grid-cols-4 gap-4 mb-4">
        <input type="text" id="kode" placeholder="Kode Barang" required class="border p-2 rounded">
        <input type="text" id="nama" placeholder="Nama Barang" required class="border p-2 rounded">
        <input type="number" id="qty" placeholder="Qty" required class="border p-2 rounded">
        <button class="bg-green-600 text-white px-4 py-2 rounded">Tambah</button>
      </form>
      <input type="text" id="cari" placeholder="Cari barang..." class="border p-2 rounded mb-4">
      <table class="w-full border text-center bg-white shadow rounded">
        <thead>
          <tr class="bg-gray-200">
            <th class="border p-2">Kode</th>
            <th class="border p-2">Nama</th>
            <th class="border p-2">Qty</th>
            <th class="border p-2">Tanggal Masuk</th>
            <th class="border p-2">Aksi</th>
          </tr>
        </thead>
        <tbody id="tabel-barang"></tbody>
      </table>
    </section>

    <!-- Transaksi -->
    <section id="transaksi" class="page hidden">
      <h2 class="text-2xl font-bold mb-6">üìë Transaksi</h2>
      <form id="form-keluar" class="grid md:grid-cols-4 gap-4 mb-4">
        <select id="store-keluar" required class="border p-2 rounded"></select>
        <input type="text" id="kode-keluar" placeholder="Kode Barang" required class="border p-2 rounded">
        <input type="number" id="qty-keluar" placeholder="Qty" required class="border p-2 rounded">
        <button class="bg-red-600 text-white px-4 py-2 rounded">Ambil</button>
      </form>
      <h3 class="text-xl font-semibold mt-6 mb-2">Mutasi Stok</h3>
      <table class="w-full border text-center bg-white shadow rounded">
        <thead>
          <tr class="bg-gray-200">
            <th class="border p-2">Tanggal</th>
            <th class="border p-2">Kode</th>
            <th class="border p-2">Nama</th>
            <th class="border p-2">Qty</th>
            <th class="border p-2">Jenis</th>
            <th class="border p-2">Store</th>
          </tr>
        </thead>
        <tbody id="tabel-transaksi"></tbody>
      </table>
    </section>

    <!-- Store -->
    <section id="store" class="page hidden">
      <h2 class="text-2xl font-bold mb-6">üè¨ Store</h2>
      <form id="form-store" class="grid md:grid-cols-3 gap-4 mb-4">
        <input type="text" id="nomor-store" placeholder="Nomor Store" required class="border p-2 rounded">
        <input type="text" id="nama-store" placeholder="Nama Store" required class="border p-2 rounded">
        <button class="bg-blue-600 text-white px-4 py-2 rounded">Tambah Store</button>
      </form>
      <ul id="daftar-store" class="list-disc pl-5"></ul>
    </section>

    <!-- Laporan -->
    <section id="laporan" class="page hidden">
      <h2 class="text-2xl font-bold mb-6">üìÑ Laporan</h2>
      <div class="flex gap-4">
        <button onclick="downloadExcel()" class="bg-green-600 text-white px-4 py-2 rounded">‚¨áÔ∏è Excel</button>
        <button onclick="downloadPDF()" class="bg-red-600 text-white px-4 py-2 rounded">‚¨áÔ∏è PDF</button>
      </div>
    </section>
  </main>

  <!-- Musik Latar -->
  <audio autoplay loop>
    <source src="musik.mp3" type="audio/mpeg">
  </audio>

  <script>
    let barang = [], store = [], transaksi = [];

    // Navigasi antar menu
    function showPage(id) {
      document.querySelectorAll(".page").forEach(p => p.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
    }

    // Tambah barang
    document.getElementById("form-masuk").addEventListener("submit", e => {
      e.preventDefault();
      const kode = document.getElementById("kode").value;
      const nama = document.getElementById("nama").value;
      const qty = parseInt(document.getElementById("qty").value);
      const tanggal = new Date().toLocaleDateString();

      barang.push({ kode, nama, qty, tanggal });
      renderBarang();
      e.target.reset();
    });

    // Render tabel barang
    function renderBarang() {
      const tbody = document.getElementById("tabel-barang");
      const cari = document.getElementById("cari").value.toLowerCase();
      tbody.innerHTML = "";
      barang.filter(b => b.kode.toLowerCase().includes(cari) || b.nama.toLowerCase().includes(cari))
        .forEach((item, i) => {
          tbody.innerHTML += `
            <tr>
              <td class="border p-2">${item.kode}</td>
              <td class="border p-2">${item.nama}</td>
              <td class="border p-2">${item.qty}</td>
              <td class="border p-2">${item.tanggal}</td>
              <td class="border p-2">
                <button onclick="hapusBarang(${i})" class="text-red-600">Hapus</button>
              </td>
            </tr>
          `;
        });
    }
    function hapusBarang(i) { barang.splice(i,1); renderBarang(); }

    // Tambah store
    document.getElementById("form-store").addEventListener("submit", e => {
      e.preventDefault();
      const nomor = document.getElementById("nomor-store").value;
      const nama = document.getElementById("nama-store").value;
      store.push({ nomor, nama });
      renderStore();
      e.target.reset();
    });
    function renderStore() {
      const ul = document.getElementById("daftar-store");
      const select = document.getElementById("store-keluar");
      ul.innerHTML = ""; select.innerHTML = "<option disabled selected>Pilih Store</option>";
      store.forEach(s => {
        ul.innerHTML += `<li>${s.nomor} - ${s.nama}</li>`;
        select.innerHTML += `<option>${s.nomor} - ${s.nama}</option>`;
      });
      document.getElementById("total-store").innerText = store.length;
    }

    // Form keluar
    document.getElementById("form-keluar").addEventListener("submit", e => {
      e.preventDefault();
      const kode = document.getElementById("kode-keluar").value;
      const qty = parseInt(document.getElementById("qty-keluar").value);
      const storeNama = document.getElementById("store-keluar").value;
      const tanggal = new Date().toLocaleDateString();

      const item = barang.find(b => b.kode === kode);
      if (!item || item.qty < qty) return alert("Stok tidak cukup!");
      item.qty -= qty;
      transaksi.push({ tanggal, kode: item.kode, nama: item.nama, qty, jenis: "Keluar", store: storeNama });
      renderBarang(); renderTransaksi();
      e.target.reset();
    });

    // Render transaksi
    function renderTransaksi() {
      const tbody = document.getElementById("tabel-transaksi");
      tbody.innerHTML = "";
      transaksi.forEach(t => {
        tbody.innerHTML += `
          <tr>
            <td class="border p-2">${t.tanggal}</td>
            <td class="border p-2">${t.kode}</td>
            <td class="border p-2">${t.nama}</td>
            <td class="border p-2">${t.qty}</td>
            <td class="border p-2">${t.jenis}</td>
            <td class="border p-2">${t.store}</td>
          </tr>
        `;
      });
    }

    // Export Excel
    function downloadExcel() {
      const ws = XLSX.utils.json_to_sheet(barang);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Barang");
      XLSX.writeFile(wb, "stok.xlsx");
    }

    // Export PDF
    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("Laporan Stok", 10, 10);
      barang.forEach((b, i) => {
        doc.text(`${b.kode} - ${b.nama} : ${b.qty}`, 10, 20 + i*10);
      });
      doc.save("laporan.pdf");
    }

    // Realtime cari
    document.getElementById("cari").addEventListener("input", renderBarang);
  </script>
</body>
</html>
