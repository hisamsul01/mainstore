<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Store Sanghyang — WMS</title>

<!-- TailwindCSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- XLSX & jsPDF -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">

<div class="container mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4">Store Sanghyang — WMS</h1>
  
  <!-- Tabs -->
  <div class="flex gap-2 mb-4">
    <button class="tab-btn px-4 py-2 bg-blue-500 text-white rounded" data-tab="master">Master</button>
    <button class="tab-btn px-4 py-2 bg-gray-200 rounded" data-tab="masuk">Stock Masuk</button>
    <button class="tab-btn px-4 py-2 bg-gray-200 rounded" data-tab="keluar">Stock Keluar</button>
    <button class="tab-btn px-4 py-2 bg-gray-200 rounded" data-tab="rekap">Rekap</button>
    <button class="tab-btn px-4 py-2 bg-gray-200 rounded" data-tab="store">Stores</button>
    <button class="tab-btn px-4 py-2 bg-gray-200 rounded" data-tab="export">Export</button>
  </div>
  
  <!-- Tab Contents -->
  <div id="tab-master" class="tab-content">
    <h2 class="font-bold mb-2">Master Barang</h2>
    <table class="w-full table-auto border-collapse border">
      <thead>
        <tr class="bg-gray-300">
          <th class="border p-2">Kode</th>
          <th class="border p-2">Nama</th>
          <th class="border p-2">Kategori</th>
          <th class="border p-2">Aksi</th>
        </tr>
      </thead>
      <tbody id="masterBody"></tbody>
    </table>
    <div class="mt-2">
      <input type="text" id="masterKode" placeholder="Kode" class="border p-1">
      <input type="text" id="masterNama" placeholder="Nama" class="border p-1">
      <input type="text" id="masterKategori" placeholder="Kategori" class="border p-1">
      <button id="addMaster" class="bg-green-500 text-white px-2 py-1 rounded">Tambah</button>
    </div>
  </div>
  
  <div id="tab-masuk" class="tab-content hidden">
    <h2 class="font-bold mb-2">Stock Masuk</h2>
    <table class="w-full table-auto border-collapse border">
      <thead>
        <tr class="bg-gray-300">
          <th class="border p-2">Tanggal</th>
          <th class="border p-2">Kode</th>
          <th class="border p-2">Nama</th>
          <th class="border p-2">Qty</th>
        </tr>
      </thead>
      <tbody id="masukBody"></tbody>
    </table>
    <div class="mt-2">
      <input type="date" id="masukTanggal" class="border p-1">
      <select id="ms_kode" class="border p-1"></select>
      <input type="text" id="ms_nama" placeholder="Nama" class="border p-1" readonly>
      <input type="number" id="ms_qty" placeholder="Qty" class="border p-1">
      <button id="addMasuk" class="bg-green-500 text-white px-2 py-1 rounded">Tambah Masuk</button>
    </div>
  </div>
  
  <div id="tab-keluar" class="tab-content hidden">
    <h2 class="font-bold mb-2">Stock Keluar</h2>
    <table class="w-full table-auto border-collapse border">
      <thead>
        <tr class="bg-gray-300">
          <th class="border p-2">Tanggal</th>
          <th class="border p-2">Kode</th>
          <th class="border p-2">Nama</th>
          <th class="border p-2">Qty</th>
        </tr>
      </thead>
      <tbody id="keluarBody"></tbody>
    </table>
    <div class="mt-2">
      <input type="date" id="keluarTanggal" class="border p-1">
      <select id="sk_kode" class="border p-1"></select>
      <input type="text" id="sk_nama" placeholder="Nama" class="border p-1" readonly>
      <input type="number" id="sk_qty" placeholder="Qty" class="border p-1">
      <button id="addKeluar" class="bg-green-500 text-white px-2 py-1 rounded">Tambah Keluar</button>
    </div>
  </div>
  
  <div id="tab-rekap" class="tab-content hidden">
    <h2 class="font-bold mb-2">Rekap Stok</h2>
    <table class="w-full table-auto border-collapse border">
      <thead>
        <tr class="bg-gray-300">
          <th class="border p-2">Kode</th>
          <th class="border p-2">Nama</th>
          <th class="border p-2">Kategori</th>
          <th class="border p-2">Stok Awal</th>
          <th class="border p-2">Masuk</th>
          <th class="border p-2">Keluar</th>
          <th class="border p-2">Stok Akhir</th>
        </tr>
      </thead>
      <tbody id="rekapBody"></tbody>
    </table>
  </div>
  
  <div id="tab-store" class="tab-content hidden">
    <h2 class="font-bold mb-2">Stores</h2>
    <ul id="storeList" class="list-disc pl-4"></ul>
    <input type="text" id="storeNama" placeholder="Nama Store" class="border p-1">
    <button id="addStore" class="bg-green-500 text-white px-2 py-1 rounded">Tambah Store</button>
  </div>
  
  <div id="tab-export" class="tab-content hidden">
    <h2 class="font-bold mb-2">Export Data</h2>
    <button id="exportExcel" class="bg-blue-500 text-white px-4 py-2 rounded">Export Excel</button>
    <button id="exportPdf" class="bg-purple-500 text-white px-4 py-2 rounded">Export PDF</button>
  </div>
</div>

<script>
  // ===== STATE =====
  const state = {
    master: [],
    masuk: [],
    keluar: [],
    stores: []
  };

  // ===== UTILS =====
  function computeRekapFor(kode) {
    const stokAwal = 0;
    const masukSum = state.masuk.filter(x=>x.kode===kode).reduce((a,b)=>a+b.qty,0);
    const keluarSum = state.keluar.filter(x=>x.kode===kode).reduce((a,b)=>a+b.qty,0);
    const stokAkhir = stokAwal + masukSum - keluarSum;
    return { stokAwal, masukSum, keluarSum, stokAkhir };
  }

  function renderMaster() {
    const tbody = document.getElementById('masterBody');
    tbody.innerHTML = '';
    state.master.forEach(m => {
      tbody.insertAdjacentHTML('beforeend', `
        <tr>
          <td class="border p-2">${m.kode}</td>
          <td class="border p-2">${m.nama}</td>
          <td class="border p-2">${m.kategori||''}</td>
        </tr>
      `);
    });
    renderSelectOptions();
    renderRekap();
  }

  function renderSelectOptions() {
    const ms = document.getElementById('ms_kode');
    const sk = document.getElementById('sk_kode');
    ms.innerHTML = '<option value="">Pilih</option>';
    sk.innerHTML = '<option value="">Pilih</option>';
    state.master.forEach(m=>{
      ms.insertAdjacentHTML('beforeend', `<option value="${m.kode}">${m.kode} - ${m.nama}</option>`);
      sk.insertAdjacentHTML('beforeend', `<option value="${m.kode}">${m.kode} - ${m.nama}</option>`);
    });
  }

  function renderMasuk() {
    const tbody = document.getElementById('masukBody'); tbody.innerHTML='';
    state.masuk.forEach(m=>{
      tbody.insertAdjacentHTML('beforeend', `<tr>
        <td class="border p-2">${m.tanggal}</td>
        <td class="border p-2">${m.kode}</td>
        <td class="border p-2">${m.nama}</td>
        <td class="border p-2 text-center">${m.qty}</td>
      </tr>`);
    });
    renderRekap();
  }

  function renderKeluar() {
    const tbody = document.getElementById('keluarBody'); tbody.innerHTML='';
    state.keluar.forEach(m=>{
      tbody.insertAdjacentHTML('beforeend', `<tr>
        <td class="border p-2">${m.tanggal}</td>
        <td class="border p-2">${m.kode}</td>
        <td class="border p-2">${m.nama}</td>
        <td class="border p-2 text-center">${m.qty}</td>
      </tr>`);
    });
    renderRekap();
  }

  function renderRekap() {
    const tbody = document.getElementById('rekapBody'); tbody.innerHTML='';
    state.master.forEach(m=>{
      const r = computeRekapFor(m.kode);
      tbody.insertAdjacentHTML('beforeend', `<tr>
        <td class="border p-2">${m.kode}</td>
        <td class="border p-2">${m.nama}</td>
        <td class="border p-2">${m.kategori||''}</td>
        <td class="border p-2 text-center">${r.stokAwal}</td>
        <td class="border p-2 text-center">${r.masukSum}</td>
        <td class="border p-2 text-center">${r.keluarSum}</td>
        <td class="border p-2 text-center font-bold">${r.stokAkhir}</td>
      </tr>`);
    });
  }

  function renderStores() {
    const ul = document.getElementById('storeList'); ul.innerHTML='';
    state.stores.forEach(s=>{
      ul.insertAdjacentHTML('beforeend', `<li>${s}</li>`);
    });
  }

  // ===== EVENTS =====
  document.getElementById('addMaster').addEventListener('click', ()=>{
    const kode = document.getElementById('masterKode').value.trim();
    const nama = document.getElementById('masterNama').value.trim();
    const kategori = document.getElementById('masterKategori').value.trim();
    if(!kode||!nama) return alert('Kode & Nama wajib');
    state.master.push({kode,nama,kategori});
    document.getElementById('masterKode').value='';
    document.getElementById('masterNama').value='';
    document.getElementById('masterKategori').value='';
    renderMaster();
  });

  document.getElementById('ms_kode').addEventListener('change',(e)=>{
    const m = state.master.find(x=>x.kode===e.target.value);
    document.getElementById('ms_nama').value = m? m.nama : '';
  });

  document.getElementById('sk_kode').addEventListener('change',(e)=>{
    const m = state.master.find(x=>x.kode===e.target.value);
    document.getElementById('sk_nama').value = m? m.nama : '';
  });

  document.getElementById('addMasuk').addEventListener('click', ()=>{
    const tgl = document.getElementById('masukTanggal').value;
    const kode = document.getElementById('ms_kode').value;
    const nama = document.getElementById('ms_nama').value;
    const qty = parseInt(document.getElementById('ms_qty').value)||0;
    if(!tgl||!kode||qty<=0) return alert('Isi semua field dengan benar');
    state.masuk.push({tanggal:tgl,kode,nama,qty});
    document.getElementById('ms_qty').value='';
    renderMasuk();
  });

  document.getElementById('addKeluar').addEventListener('click', ()=>{
    const tgl = document.getElementById('keluarTanggal').value;
    const kode = document.getElementById('sk_kode').value;
    const nama = document.getElementById('sk_nama').value;
    const qty = parseInt(document.getElementById('sk_qty').value)||0;
    if(!tgl||!kode||qty<=0) return alert('Isi semua field dengan benar');
    state.keluar.push({tanggal:tgl,kode,nama,qty});
    document.getElementById('sk_qty').value='';
    renderKeluar();
  });

  document.getElementById('addStore').addEventListener('click', ()=>{
    const s = document.getElementById('storeNama').value.trim();
    if(!s) return;
    state.stores.push(s);
    document.getElementById('storeNama').value='';
    renderStores();
  });

  document.querySelectorAll('.tab-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.replace('bg-blue-500','bg-gray-200')||b.classList.replace('text-white',''));
      btn.classList.add('bg-blue-500','text-white');
      const tab = btn.dataset.tab;
      document.querySelectorAll('.tab-content').forEach(tc=>tc.classList.add('hidden'));
      document.getElementById('tab-'+tab).classList.remove('hidden');
    });
  });

  document.getElementById('exportExcel').addEventListener('click', ()=>{
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(state.master),'Master');
    XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(state.masuk),'Masuk');
    XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(state.keluar),'Keluar');
    XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(state.stores.map(s=>({store:s}))),'Stores');
    XLSX.writeFile(wb,'wms_export.xlsx');
  });

  document.getElementById('exportPdf').addEventListener('click', ()=>{
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text('Ringkasan Inventory',20,20);
    const rows = state.master.map(m=>{
      const r = computeRekapFor(m.kode);
      return [m.kode,m.nama,r.stokAkhir];
    });
    doc.autoTable({ head:[['Kode','Nama','Stok Akhir']], body:rows, startY:40 });
    doc.save('wms_summary.pdf');
  });
</script>

</body>
</html>
